@if (data(); as d) {
  <div class="sparkline-wrapper">
    <div class="sparkline-container">
      <svg viewBox="0 0 240 120" class="sparkline-svg">
        @for (tick of d.yTicks; track tick.label) {
          <line [attr.x1]="d.axisLeft" [attr.y1]="tick.y"
                [attr.x2]="d.axisRight" [attr.y2]="tick.y"
                class="grid-line" />
          <text [attr.x]="d.axisLeft - 4" [attr.y]="tick.y + 2.5"
                text-anchor="end" class="axis-label">{{ tick.label }}</text>
        }
        <line [attr.x1]="d.axisLeft" [attr.y1]="d.axisTop"
              [attr.x2]="d.axisLeft" [attr.y2]="d.axisBottom"
              class="axis-line" />
        <line [attr.x1]="d.axisLeft" [attr.y1]="d.axisBottom"
              [attr.x2]="d.axisRight" [attr.y2]="d.axisBottom"
              class="axis-line" />
        <polyline
          [attr.points]="d.trend.trendLine"
          fill="none"
          stroke="#f59e0b"
          stroke-width="1.5"
          stroke-dasharray="4 3" />
        <polyline
          [attr.points]="d.polyline"
          fill="none"
          stroke="#3b82f6"
          stroke-width="2"
          stroke-linejoin="round"
          stroke-linecap="round" />
        @for (pt of d.points; track pt.label) {
          <circle [attr.cx]="pt.x" [attr.cy]="pt.y" r="3" fill="#3b82f6">
            <title>{{ pt.label }}: {{ formatTooltip() ? formatTooltip()!(pt.value) : pt.value }}</title>
          </circle>
          <text [attr.x]="pt.x" [attr.y]="d.axisBottom + 12"
                text-anchor="middle" class="axis-label">{{ pt.label }}</text>
        }
      </svg>
    </div>
    <div class="change-badges">
      <div class="change-badge" [class]="totalClass()">
        <span class="change-label">Total</span>
        <span>{{ totalLabel() }}</span>
      </div>
      <div class="change-badge" [class]="trendClass()">
        <span class="change-label trend-label">Trend
          <span class="info-icon" data-tooltip="Least-squares linear regression (best-fit straight line) through all data points. The percentage reflects the change from the fitted start value to the fitted end value.">&#9432;</span>
        </span>
        <span>{{ trendLabel() }}</span>
      </div>
    </div>
  </div>
} @else {
  <div class="sparkline-wrapper">
    <div class="sparkline-empty">Insufficient data</div>
  </div>
}